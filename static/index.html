<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Transcribe audio files locally using Whisper. Supports English and Filipino/Tagalog.">
    <title>Whisper Audio Transcription - Local Processing</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <main id="main-content" class="container" role="main">
        <header role="banner">
            <h1><span aria-hidden="true">üéôÔ∏è</span> Audio Transcription</h1>
            <p>Drop audio files here for instant transcription</p>
            <p class="subtitle">Single or multiple files ‚Ä¢ M4A, MP3, WAV, AAC, MP4 ‚Ä¢ English and Filipino/Tagalog ‚Ä¢ Max 500MB each</p>
        </header>

        <section aria-labelledby="upload-heading">
            <h2 id="upload-heading" class="visually-hidden">Upload Audio File</h2>
            <div id="dropZone" 
                 class="drop-zone"
                 role="button"
                 tabindex="0"
                 aria-label="Upload audio files. Press Space or Enter to browse files, or drag and drop your audio files here. Supports multiple files for batch processing."
                 aria-describedby="file-requirements">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <p class="drop-text">Drop audio files here or click to browse</p>
                <p id="file-requirements" class="drop-hint">
                    <strong>Accepted formats:</strong> M4A, MP3, WAV, AAC, MP4<br>
                    <strong>Maximum size:</strong> 500MB
                </p>
                <input type="file" id="fileInput" accept=".m4a,.mp3,.wav,.aac,.mp4" aria-label="Choose audio files" multiple hidden>
            </div>
        </section>

        <!-- Single File Progress (Legacy) -->
        <section id="progressSection" class="progress-section" style="display: none;" aria-labelledby="progress-heading" aria-live="polite">
            <h2 id="progress-heading" class="visually-hidden">Transcription Progress</h2>
            <div class="file-info">
                <span class="file-name" id="fileName"></span>
                <span class="file-size" id="fileSize"></span>
            </div>
            
            <div class="progress-container" 
                 role="progressbar" 
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100"
                 aria-label="Transcription progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="status-message" id="statusMessage" aria-live="polite">Preparing...</div>
            <div class="time-estimate" id="timeEstimate" aria-live="polite"></div>
        </section>
        
        <!-- Batch Processing Interface -->
        <section id="batchSection" class="batch-section" style="display: none;" aria-labelledby="batch-heading" aria-live="polite">
            <h2 id="batch-heading" class="batch-title">Batch Transcription</h2>
            
            <!-- Batch Summary -->
            <div class="batch-summary">
                <div class="batch-stats">
                    <span class="stat-item">
                        <span class="stat-number" id="batchTotal">0</span>
                        <span class="stat-label">Total Files</span>
                    </span>
                    <span class="stat-item">
                        <span class="stat-number" id="batchCompleted">0</span>
                        <span class="stat-label">Completed</span>
                    </span>
                    <span class="stat-item">
                        <span class="stat-number" id="batchFailed">0</span>
                        <span class="stat-label">Failed</span>
                    </span>
                </div>
                
                <!-- Overall Progress -->
                <div class="batch-progress-container" 
                     role="progressbar" 
                     aria-valuenow="0" 
                     aria-valuemin="0" 
                     aria-valuemax="100"
                     aria-label="Overall batch progress">
                    <div class="batch-progress-bar" id="batchProgressBar"></div>
                </div>
                
                <div class="batch-status" id="batchStatus" aria-live="polite">Preparing batch...</div>
            </div>
            
            <!-- Optional Folder Selection During Processing -->
            <div class="processing-folder-section" id="processingFolderSection" style="display: none;">
                <div class="folder-selection-card">
                    <h3 class="folder-heading">üíæ Save Location</h3>
                    <p class="folder-description">Choose where to save completed transcripts (optional)</p>
                    <div class="folder-buttons">
                        <button type="button" 
                                id="chooseFolderBtn" 
                                class="choose-folder-btn">
                            üìÅ Choose Folder
                        </button>
                        <button type="button"
                                id="clearFolderBtn"
                                class="clear-folder-btn"
                                style="display: none;">
                            ‚ùå Clear Saved Folder
                        </button>
                    </div>
                    <div class="selected-folder" id="selectedFolder" style="display: none;">
                        <span class="folder-icon">‚úÖ</span>
                        <span class="folder-path" id="selectedFolderPath">Folder selected</span>
                    </div>
                    <div class="folder-status" id="folderStatus">
                        Files will download individually if no folder is selected
                    </div>
                </div>
            </div>
            
            <!-- Current File Being Processed -->
            <div class="current-file-section" id="currentFileSection" style="display: none;">
                <h3 class="current-file-heading">Currently Processing</h3>
                <div class="current-file-info">
                    <span class="current-file-name" id="currentFileName"></span>
                    <span class="current-file-progress" id="currentFileProgress">0%</span>
                </div>
                <div class="current-file-progress-container" 
                     role="progressbar" 
                     aria-valuenow="0" 
                     aria-valuemin="0" 
                     aria-valuemax="100"
                     aria-label="Current file progress">
                    <div class="current-file-progress-bar" id="currentFileProgressBar"></div>
                </div>
                <div class="current-file-status" id="currentFileStatus" aria-live="polite"></div>
            </div>
            
            <!-- File Queue -->
            <div class="file-queue-section">
                <div class="queue-header">
                    <h3>File Queue</h3>
                    <button id="toggleQueue" class="toggle-queue-btn" aria-label="Toggle file queue visibility">
                        <span class="queue-toggle-text">Show Details</span>
                        <svg class="queue-toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="file-queue" id="fileQueue" style="display: none;">
                    <!-- File items will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <section id="resultSection" class="result-section" style="display: none;" aria-labelledby="result-heading">
            <h2 id="result-heading"><span aria-hidden="true">‚úÖ</span> Transcription Complete</h2>
            
            <!-- Tab Navigation -->
            <div class="tabs" id="resultTabs">
                <button class="tab-button active" data-tab="transcript" aria-selected="true">
                    Raw Transcript
                </button>
                <button class="tab-button" data-tab="analysis" aria-selected="false" style="display: none;" id="analysisTabBtn">
                    Meeting Analysis
                </button>
                <button class="tab-button" data-tab="cleaned" aria-selected="false" style="display: none;" id="cleanedTabBtn">
                    Cleaned Transcript
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Raw Transcript Tab -->
                <div class="tab-pane active" id="transcriptTab">
                    <div class="transcript-preview" id="transcriptPreview" aria-label="Transcript preview"></div>
                </div>
                
                <!-- Analysis Tab -->
                <div class="tab-pane" id="analysisTab" style="display: none;">
                    <div class="analysis-content" id="analysisContent">
                        <div class="analysis-section">
                            <h3>üìä Meeting Summary</h3>
                            <div id="analysisSummary" class="analysis-text"></div>
                        </div>
                        <div class="analysis-section">
                            <h3>‚úÖ Key Decisions</h3>
                            <ul id="analysisDecisions" class="analysis-list"></ul>
                        </div>
                        <div class="analysis-section">
                            <h3>üí¨ Discussion Points</h3>
                            <ul id="analysisDiscussion" class="analysis-list"></ul>
                        </div>
                        <div class="analysis-section">
                            <h3>üìã Action Items</h3>
                            <div id="analysisActions" class="action-items"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Cleaned Transcript Tab -->
                <div class="tab-pane" id="cleanedTab" style="display: none;">
                    <div class="transcript-preview" id="cleanedTranscript"></div>
                </div>
            </div>
            
            <!-- Analysis Progress -->
            <div id="analysisProgress" style="display: none;" class="analysis-progress">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="analysisProgressBar"></div>
                </div>
                <p id="analysisStatus">Analyzing meeting content...</p>
            </div>
            
            <div class="action-buttons">
                <button id="analyzeBtn" class="btn btn-success" aria-label="Analyze meeting transcript" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M9 11H3v2h6v-2zm0-4H3v2h6V7zm0 8H3v2h6v-2zm12-8h-6v2h6V7zm0 4h-6v2h6v-2zm0 4h-6v2h6v-2z"></path>
                    </svg>
                    Analyze Meeting
                </button>
                
                <!-- Sync to Notion button -->
                <button id="notionSyncBtn" class="btn btn-notion" aria-label="Sync to Notion" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"></path>
                    </svg>
                    Sync to Notion
                </button>
                <button id="downloadBtn" class="btn btn-primary" aria-label="Download transcript as text file">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download Transcript
                </button>
                
                <!-- Export dropdown for analysis results -->
                <div class="export-dropdown" id="exportDropdown" style="display: none;">
                    <button class="btn btn-primary dropdown-toggle" id="exportBtn">
                        Export Analysis ‚ñº
                    </button>
                    <div class="dropdown-menu" id="exportMenu" style="display: none;">
                        <button class="dropdown-item" data-format="markdown">Export as Markdown</button>
                        <button class="dropdown-item" data-format="text">Export as Text</button>
                        <button class="dropdown-item" data-format="json">Export as JSON</button>
                    </div>
                </div>
                
                <button id="newFileBtn" class="btn btn-secondary" aria-label="Start new transcription">
                    Transcribe Another File
                </button>
            </div>
        </section>

        <section id="errorSection" class="error-section" style="display: none;" role="alert" aria-labelledby="error-heading">
            <h2 id="error-heading"><span aria-hidden="true">‚ùå</span> Error</h2>
            <p id="errorMessage"></p>
            <div id="errorHelp" class="error-help"></div>
            <button id="retryBtn" class="btn btn-secondary" aria-label="Try transcription again">Try Again</button>
        </section>
    </main>

    <footer role="contentinfo">
        <p>Powered by Whisper.cpp ‚Ä¢ Running locally on your machine ‚Ä¢ Processing time ‚âà audio duration</p>
    </footer>
    
    <!-- Notion Sync Modal -->
    <div id="notionSyncModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Syncing to Notion</h2>
            <div class="sync-progress" id="syncProgress">
                <div class="spinner"></div>
                <p id="syncStatus">Connecting to Notion...</p>
            </div>
            <div class="sync-results" id="syncResults" style="display: none;">
                <h3>Sync Complete!</h3>
                <div id="syncSummary"></div>
                <button class="btn btn-primary" id="closeSyncModal">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>